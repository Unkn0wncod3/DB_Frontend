<section class="entry-detail">
  <header class="entry-detail__header">
    <div class="entry-detail__title">
      <a routerLink="/" class="entry-detail__back">{{ 'entryDetail.actions.back' | translate }}</a>
      <h1>{{ 'entryDetail.title' | translate:{ value: entryTitle() ?? (entryId ?? ('entryDetail.labels.unknownId' | translate)) } }}</h1>
      <p *ngIf="entryType || entryId">
        <span *ngIf="entryType">{{ 'entryDetail.labels.type' | translate:{ type: entryType } }}</span>
        <span *ngIf="entryType && entryId" aria-hidden="true">&nbsp;&middot;&nbsp;</span>
        <span *ngIf="entryId">{{ 'entryDetail.labels.id' | translate:{ id: entryId } }}</span>
      </p>
    </div>
    <div class="entry-detail__actions">
      <div
        class="entry-detail__layout-toggle"
        *ngIf="showPersonRelations() && entryId"
        role="group"
        [attr.aria-label]="'entryDetail.relations.layoutLabel' | translate">
        <label class="entry-detail__layout-option">
          <input
            type="radio"
            name="relationsLayout"
            value="side"
            [checked]="relationsLayout() === 'side'"
            (change)="onRelationsLayoutChange('side')"
          />
          <span class="entry-detail__layout-body">
            <span class="entry-detail__layout-icon entry-detail__layout-icon--side" aria-hidden="true"></span>
            <span class="sr-only">
              {{ 'entryDetail.relations.layoutOptionSide' | translate }}
            </span>
          </span>
        </label>
        <label class="entry-detail__layout-option">
          <input
            type="radio"
            name="relationsLayout"
            value="stacked"
            [checked]="relationsLayout() === 'stacked'"
            (change)="onRelationsLayoutChange('stacked')"
          />
          <span class="entry-detail__layout-body">
            <span class="entry-detail__layout-icon entry-detail__layout-icon--stacked" aria-hidden="true"></span>
            <span class="sr-only">
              {{ 'entryDetail.relations.layoutOptionStacked' | translate }}
            </span>
          </span>
        </label>
      </div>
      <button
        type="button"
        class="entry-detail__raw-toggle"
        (click)="toggleRawView()"
        [attr.aria-pressed]="showRawView()"
        [attr.aria-label]="(showRawView() ? 'entryDetail.rawView.hide' : 'entryDetail.rawView.show') | translate">
        <span class="entry-detail__raw-toggle-track" aria-hidden="true">
          <span class="entry-detail__raw-toggle-thumb" [class.entry-detail__raw-toggle-thumb--active]="showRawView()"></span>
        </span>
        <span class="entry-detail__raw-toggle-label">{{ 'entryDetail.rawView.label' | translate }}</span>
      </button>
      <button type="button" class="entry-detail__refresh" (click)="refresh()" [disabled]="isLoading() || isSaving()">
        <span *ngIf="isLoading(); else refreshLabel">{{ 'entryDetail.status.loading' | translate }}</span>
        <ng-template #refreshLabel>{{ 'entryDetail.actions.refresh' | translate }}</ng-template>
      </button>
      <button type="submit" form="entryDetailForm" class="entry-detail__save" [disabled]="!hasChanges() || isSaving()">
        <span *ngIf="isSaving(); else saveLabel">{{ 'entryDetail.status.saving' | translate }}</span>
        <ng-template #saveLabel>{{ 'entryDetail.actions.save' | translate }}</ng-template>
      </button>
      <button *ngIf="canEditEntries()" type="button" class="entry-detail__delete" (click)="openDeleteDialog()" [disabled]="isDeleting()">
        <span *ngIf="isDeleting(); else deleteLabel">{{ 'entryDetail.status.deleting' | translate }}</span>
        <ng-template #deleteLabel>{{ 'entryDetail.actions.delete' | translate }}</ng-template>
      </button>
    </div>
    <p class="entry-detail__readonly" *ngIf="!canEditEntries()">
      {{ 'entryDetail.status.readOnly' | translate }}
    </p>
  </header>

  <section *ngIf="errorMessage() as error" class="entry-detail__alert entry-detail__alert--error">
    <p>{{ error }}</p>
  </section>

  <section *ngIf="successMessage() as success" class="entry-detail__alert entry-detail__alert--success">
    <p>{{ success }}</p>
  </section>

  <div
    class="entry-detail__content"
    [class.entry-detail__content--stacked]="relationsLayout() === 'stacked'"
    *ngIf="entry() as record">
    <form
      id="entryDetailForm"
      class="entry-detail__form"
      [formGroup]="form"
      (ngSubmit)="save()"
    >
      <app-entry-detail-field-grid
        [form]="form"
        [fields]="fields()"
        [booleanOptions]="booleanOptions()"
      ></app-entry-detail-field-grid>
    </form>

    <app-entry-detail-relations
      *ngIf="showPersonRelations() && entryId"
      [personId]="entryId"
      [entryTitle]="entryTitle()"
      (statusMessage)="successMessage.set($event)"
    ></app-entry-detail-relations>
  </div>

  <section *ngIf="!entry() && !isLoading()" class="entry-detail__state">
    <p>{{ 'entryDetail.status.empty' | translate }}</p>
  </section>

  <app-entry-detail-raw-view [record]="entry()" [activated]="showRawView()"></app-entry-detail-raw-view>

  <app-entry-detail-delete-dialog
    [isOpen]="isDeleteDialogOpen()"
    [isDeleting]="isDeleting()"
    [securityKey]="deleteSecurityKey"
    (confirmed)="handleDeleteConfirmed()"
    (closed)="closeDeleteDialog()"
  ></app-entry-detail-delete-dialog>
</section>
